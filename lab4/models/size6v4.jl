import LinearAlgebra
using JuMP
using GLPK

function model()

    model = Model(GLPK.Optimizer)

    # x[i, j] - flow from node i to node j
    # Warning: In this model nodes are from 1 to 2^k
    @variable(model, x[1:64, 1:64], Int)

    # Capacities of given arcs
   @constraint(model, [i = 0:63, j = 0:63; count_ones(i ⊻ j) != 1], x[i+1, j+1] == 0)
   @constraint(model, [i = 0:63, j = 0:63; i>j && count_ones(i ⊻ j) == 1], x[i+1, j+1] == 0)
   @constraint(model, x[1, 2] <= 39)
   @constraint(model, x[1, 3] <= 22)
   @constraint(model, x[1, 5] <= 8)
   @constraint(model, x[1, 9] <= 64)
   @constraint(model, x[1, 17] <= 40)
   @constraint(model, x[1, 33] <= 27)
   @constraint(model, x[2, 4] <= 8)
   @constraint(model, x[2, 6] <= 14)
   @constraint(model, x[2, 10] <= 14)
   @constraint(model, x[2, 18] <= 6)
   @constraint(model, x[2, 34] <= 27)
   @constraint(model, x[3, 4] <= 2)
   @constraint(model, x[3, 7] <= 1)
   @constraint(model, x[3, 11] <= 13)
   @constraint(model, x[3, 19] <= 6)
   @constraint(model, x[3, 35] <= 25)
   @constraint(model, x[4, 8] <= 2)
   @constraint(model, x[4, 12] <= 7)
   @constraint(model, x[4, 20] <= 1)
   @constraint(model, x[4, 36] <= 3)
   @constraint(model, x[5, 6] <= 11)
   @constraint(model, x[5, 7] <= 6)
   @constraint(model, x[5, 13] <= 6)
   @constraint(model, x[5, 21] <= 13)
   @constraint(model, x[5, 37] <= 21)
   @constraint(model, x[6, 8] <= 6)
   @constraint(model, x[6, 14] <= 5)
   @constraint(model, x[6, 22] <= 9)
   @constraint(model, x[6, 38] <= 11)
   @constraint(model, x[7, 8] <= 5)
   @constraint(model, x[7, 15] <= 15)
   @constraint(model, x[7, 23] <= 14)
   @constraint(model, x[7, 39] <= 8)
   @constraint(model, x[8, 16] <= 6)
   @constraint(model, x[8, 24] <= 2)
   @constraint(model, x[8, 40] <= 3)
   @constraint(model, x[9, 10] <= 16)
   @constraint(model, x[9, 11] <= 14)
   @constraint(model, x[9, 13] <= 13)
   @constraint(model, x[9, 25] <= 1)
   @constraint(model, x[9, 41] <= 11)
   @constraint(model, x[10, 12] <= 2)
   @constraint(model, x[10, 14] <= 10)
   @constraint(model, x[10, 26] <= 16)
   @constraint(model, x[10, 42] <= 11)
   @constraint(model, x[11, 12] <= 8)
   @constraint(model, x[11, 15] <= 4)
   @constraint(model, x[11, 27] <= 12)
   @constraint(model, x[11, 43] <= 4)
   @constraint(model, x[12, 16] <= 9)
   @constraint(model, x[12, 28] <= 14)
   @constraint(model, x[12, 44] <= 6)
   @constraint(model, x[13, 14] <= 16)
   @constraint(model, x[13, 15] <= 12)
   @constraint(model, x[13, 29] <= 16)
   @constraint(model, x[13, 45] <= 13)
   @constraint(model, x[14, 16] <= 1)
   @constraint(model, x[14, 30] <= 15)
   @constraint(model, x[14, 46] <= 14)
   @constraint(model, x[15, 16] <= 15)
   @constraint(model, x[15, 31] <= 10)
   @constraint(model, x[15, 47] <= 9)
   @constraint(model, x[16, 32] <= 27)
   @constraint(model, x[16, 48] <= 29)
   @constraint(model, x[17, 18] <= 7)
   @constraint(model, x[17, 19] <= 12)
   @constraint(model, x[17, 21] <= 8)
   @constraint(model, x[17, 25] <= 27)
   @constraint(model, x[17, 49] <= 15)
   @constraint(model, x[18, 20] <= 10)
   @constraint(model, x[18, 22] <= 12)
   @constraint(model, x[18, 26] <= 4)
   @constraint(model, x[18, 50] <= 10)
   @constraint(model, x[19, 20] <= 3)
   @constraint(model, x[19, 23] <= 9)
   @constraint(model, x[19, 27] <= 4)
   @constraint(model, x[19, 51] <= 7)
   @constraint(model, x[20, 24] <= 12)
   @constraint(model, x[20, 28] <= 8)
   @constraint(model, x[20, 52] <= 12)
   @constraint(model, x[21, 22] <= 15)
   @constraint(model, x[21, 23] <= 11)
   @constraint(model, x[21, 29] <= 3)
   @constraint(model, x[21, 53] <= 16)
   @constraint(model, x[22, 24] <= 3)
   @constraint(model, x[22, 30] <= 9)
   @constraint(model, x[22, 54] <= 6)
   @constraint(model, x[23, 24] <= 13)
   @constraint(model, x[23, 31] <= 2)
   @constraint(model, x[23, 55] <= 3)
   @constraint(model, x[24, 32] <= 27)
   @constraint(model, x[24, 56] <= 16)
   @constraint(model, x[25, 26] <= 1)
   @constraint(model, x[25, 27] <= 6)
   @constraint(model, x[25, 29] <= 2)
   @constraint(model, x[25, 57] <= 16)
   @constraint(model, x[26, 28] <= 7)
   @constraint(model, x[26, 30] <= 9)
   @constraint(model, x[26, 58] <= 16)
   @constraint(model, x[27, 28] <= 12)
   @constraint(model, x[27, 31] <= 2)
   @constraint(model, x[27, 59] <= 4)
   @constraint(model, x[28, 32] <= 18)
   @constraint(model, x[28, 60] <= 15)
   @constraint(model, x[29, 30] <= 2)
   @constraint(model, x[29, 31] <= 16)
   @constraint(model, x[29, 61] <= 14)
   @constraint(model, x[30, 32] <= 13)
   @constraint(model, x[30, 62] <= 2)
   @constraint(model, x[31, 32] <= 14)
   @constraint(model, x[31, 63] <= 1)
   @constraint(model, x[32, 64] <= 33)
   @constraint(model, x[33, 34] <= 16)
   @constraint(model, x[33, 35] <= 4)
   @constraint(model, x[33, 37] <= 27)
   @constraint(model, x[33, 41] <= 26)
   @constraint(model, x[33, 49] <= 26)
   @constraint(model, x[34, 36] <= 12)
   @constraint(model, x[34, 38] <= 6)
   @constraint(model, x[34, 42] <= 7)
   @constraint(model, x[34, 50] <= 14)
   @constraint(model, x[35, 36] <= 16)
   @constraint(model, x[35, 39] <= 10)
   @constraint(model, x[35, 43] <= 1)
   @constraint(model, x[35, 51] <= 9)
   @constraint(model, x[36, 40] <= 4)
   @constraint(model, x[36, 44] <= 2)
   @constraint(model, x[36, 52] <= 3)
   @constraint(model, x[37, 38] <= 9)
   @constraint(model, x[37, 39] <= 4)
   @constraint(model, x[37, 45] <= 10)
   @constraint(model, x[37, 53] <= 13)
   @constraint(model, x[38, 40] <= 5)
   @constraint(model, x[38, 46] <= 6)
   @constraint(model, x[38, 54] <= 4)
   @constraint(model, x[39, 40] <= 12)
   @constraint(model, x[39, 47] <= 9)
   @constraint(model, x[39, 55] <= 6)
   @constraint(model, x[40, 48] <= 3)
   @constraint(model, x[40, 56] <= 10)
   @constraint(model, x[41, 42] <= 12)
   @constraint(model, x[41, 43] <= 4)
   @constraint(model, x[41, 45] <= 6)
   @constraint(model, x[41, 57] <= 16)
   @constraint(model, x[42, 44] <= 2)
   @constraint(model, x[42, 46] <= 13)
   @constraint(model, x[42, 58] <= 6)
   @constraint(model, x[43, 44] <= 6)
   @constraint(model, x[43, 47] <= 6)
   @constraint(model, x[43, 59] <= 2)
   @constraint(model, x[44, 48] <= 6)
   @constraint(model, x[44, 60] <= 25)
   @constraint(model, x[45, 46] <= 5)
   @constraint(model, x[45, 47] <= 15)
   @constraint(model, x[45, 61] <= 15)
   @constraint(model, x[46, 48] <= 7)
   @constraint(model, x[46, 62] <= 24)
   @constraint(model, x[47, 48] <= 4)
   @constraint(model, x[47, 63] <= 3)
   @constraint(model, x[48, 64] <= 64)
   @constraint(model, x[49, 50] <= 12)
   @constraint(model, x[49, 51] <= 8)
   @constraint(model, x[49, 53] <= 1)
   @constraint(model, x[49, 57] <= 10)
   @constraint(model, x[50, 52] <= 12)
   @constraint(model, x[50, 54] <= 14)
   @constraint(model, x[50, 58] <= 7)
   @constraint(model, x[51, 52] <= 13)
   @constraint(model, x[51, 55] <= 10)
   @constraint(model, x[51, 59] <= 13)
   @constraint(model, x[52, 56] <= 12)
   @constraint(model, x[52, 60] <= 24)
   @constraint(model, x[53, 54] <= 15)
   @constraint(model, x[53, 55] <= 5)
   @constraint(model, x[53, 61] <= 5)
   @constraint(model, x[54, 56] <= 24)
   @constraint(model, x[54, 62] <= 19)
   @constraint(model, x[55, 56] <= 17)
   @constraint(model, x[55, 63] <= 1)
   @constraint(model, x[56, 64] <= 15)
   @constraint(model, x[57, 58] <= 10)
   @constraint(model, x[57, 59] <= 3)
   @constraint(model, x[57, 61] <= 13)
   @constraint(model, x[58, 60] <= 29)
   @constraint(model, x[58, 62] <= 15)
   @constraint(model, x[59, 60] <= 16)
   @constraint(model, x[59, 63] <= 28)
   @constraint(model, x[60, 64] <= 49)
   @constraint(model, x[61, 62] <= 13)
   @constraint(model, x[61, 63] <= 23)
   @constraint(model, x[62, 64] <= 4)
   @constraint(model, x[63, 64] <= 29)

    # Flow must be balanced
   @constraint(model, [i = 2:63], sum(x[i, :]) == sum(x[:, i]))
    @constraint(model, sum(x[1, :])  == sum(x[:, 64]))
    # Trying to maximize the flow
    @objective(model, Max, sum(x[1, :]))

    optimize!(model)
    println(Int64(objective_value(model)))
end

println(@elapsed model())
